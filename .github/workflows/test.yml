name: Run Godot Tests

on:
  pull_request:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Check tab indentation
        run: bash check_tabs.sh
      - name: Set up Godot
        uses: chickensoft-games/setup-godot@v2
        with:
          version: 4.6.1
          use-dotnet: false
          include-templates: false
      - name: Import project resources
        run: godot -e --headless --path src --quit-after 2
      - name: Run tests
        run: |
          godot --headless --path src -s res://tests/test_import_openai.gd && \
          godot --headless --path src -s res://tests/test_application_start.gd && \
          godot --headless --path src -s res://tests/test_load_examples.gd && \
          godot --headless --path src -s res://tests/test_schema_title_sync.gd && \
          godot --headless --path src -s res://tests/test_schema_validator_request.gd && \
          godot --headless --path src -s res://tests/test_schema_align_openai.gd && \
          godot --headless --path src -s res://tests/test_schema_form_roundtrip.gd && \
          godot --headless --path src -s res://tests/test_schema_form_array_enum.gd && \
          godot --headless --path src -s res://tests/test_schema_form_union_and_fallback.gd && \
          godot --headless --path src -s res://tests/test_json_schema_validator_extended.gd
